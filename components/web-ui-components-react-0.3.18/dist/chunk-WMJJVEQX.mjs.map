{"version":3,"sources":["../src/hooks/use-core-client.ts","../src/hooks/use-core-client-initialization.ts","../src/hooks/use-scope-manager.ts","../src/providers/scope-manager-provider.tsx"],"sourcesContent":["import type { CoreClientInterface } from '@auth0/web-ui-components-core';\nimport * as React from 'react';\n\nconst CoreClientContext = React.createContext<{\n  coreClient: CoreClientInterface | null;\n}>({\n  coreClient: null,\n});\n\n/**\n * Hook to access the CoreClient instance from context.\n *\n * Provides access to the initialized CoreClient which handles API calls and business logic.\n *\n * @returns {{ coreClient: CoreClientInterface | null }} The current CoreClient instance or null if not initialized.\n *\n * @throws {Error} Throws if used outside of an Auth0ComponentProvider.\n */\nexport const useCoreClient = () => {\n  const context = React.useContext(CoreClientContext);\n  if (!context) {\n    throw new Error('useCoreClient must be used within Auth0ComponentProvider');\n  }\n  return context;\n};\n\nexport { CoreClientContext };\n","import type {\n  CoreClientInterface,\n  AuthDetails,\n  I18nInitOptions,\n} from '@auth0/web-ui-components-core';\nimport { createCoreClient } from '@auth0/web-ui-components-core';\nimport * as React from 'react';\n\ninterface UseCoreClientInitializationProps {\n  authDetails: AuthDetails;\n  i18nOptions?: I18nInitOptions;\n}\n\n/**\n * Custom hook to handle CoreClient initialization\n */\nexport const useCoreClientInitialization = ({\n  authDetails,\n  i18nOptions,\n}: UseCoreClientInitializationProps) => {\n  const [coreClient, setCoreClient] = React.useState<CoreClientInterface | null>(null);\n\n  React.useEffect(() => {\n    const initializeCoreClient = async () => {\n      try {\n        const initializedCoreClient = await createCoreClient(authDetails, i18nOptions);\n\n        setCoreClient(initializedCoreClient);\n      } catch (error) {\n        console.error(error);\n      }\n    };\n\n    initializeCoreClient();\n  }, [i18nOptions, authDetails]);\n\n  return coreClient;\n};\n","import { createContext, useContext } from 'react';\n\nexport type Audience = 'me' | 'my-org';\n\nexport interface ScopeManagerContextValue {\n  registerScopes: (audience: Audience, scopes: string) => void;\n  isReady: boolean;\n  ensured: Record<Audience, string>;\n}\n\nexport const ScopeManagerContext = createContext<ScopeManagerContextValue>({\n  registerScopes: () => {},\n  isReady: false,\n  ensured: { me: '', 'my-org': '' },\n});\n\nexport const useScopeManager = () => useContext(ScopeManagerContext);\n","import React, { useRef, useState, useCallback, useEffect, type ReactNode } from 'react';\n\nimport { useCoreClient } from '../hooks/use-core-client';\nimport { ScopeManagerContext, type Audience } from '../hooks/use-scope-manager';\n\nexport const ScopeManagerProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\n  const { coreClient } = useCoreClient();\n\n  const scopeRegistry = useRef<Record<Audience, Set<string>>>({\n    me: new Set(),\n    'my-org': new Set(),\n  });\n\n  const [ensured, setEnsured] = useState<Record<Audience, string>>({\n    me: '',\n    'my-org': '',\n  });\n\n  const [isReady, setIsReady] = useState(false);\n  const [version, setVersion] = useState(0);\n\n  const registerScopes = useCallback((audience: Audience, scopes: string) => {\n    if (!scopes?.trim()) return;\n\n    const newScopes = scopes\n      .split(/\\s+/)\n      .map((s) => s.trim())\n      .filter(Boolean);\n\n    const audienceSet = scopeRegistry.current[audience];\n    let changed = false;\n\n    newScopes.forEach((scope) => {\n      if (!audienceSet.has(scope)) {\n        audienceSet.add(scope);\n        changed = true;\n      }\n    });\n\n    if (changed) {\n      setIsReady(false);\n      setVersion((v) => v + 1);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (!coreClient) return;\n\n    const ensureAllScopesSequential = async () => {\n      const nextEnsured: Record<Audience, string> = { ...ensured };\n      let hasScopes = false;\n      let updated = false;\n\n      for (const audience of ['me', 'my-org'] as const) {\n        const scopes = Array.from(scopeRegistry.current[audience]).sort();\n        const scopeString = scopes.join(' ');\n\n        if (scopes.length > 0) {\n          hasScopes = true;\n\n          if (scopeString !== ensured[audience]) {\n            await coreClient.ensureScopes(scopeString, audience);\n            nextEnsured[audience] = scopeString;\n            updated = true;\n          }\n        }\n      }\n\n      if (updated && JSON.stringify(nextEnsured) !== JSON.stringify(ensured)) {\n        setEnsured(nextEnsured);\n      }\n\n      setIsReady(hasScopes);\n    };\n\n    ensureAllScopesSequential();\n  }, [coreClient, version]);\n\n  return (\n    <ScopeManagerContext.Provider value={{ registerScopes, isReady, ensured }}>\n      {children}\n    </ScopeManagerContext.Provider>\n  );\n};\n"],"mappings":"AACA,UAAYA,MAAW,QAEvB,IAAMC,EAA0B,gBAE7B,CACD,WAAY,IACd,CAAC,EAWYC,EAAgB,IAAM,CACjC,IAAMC,EAAgB,aAAWF,CAAiB,EAClD,GAAI,CAACE,EACH,MAAM,IAAI,MAAM,0DAA0D,EAE5E,OAAOA,CACT,ECnBA,OAAS,oBAAAC,MAAwB,gCACjC,UAAYC,MAAW,QAUhB,IAAMC,EAA8B,CAAC,CAC1C,YAAAC,EACA,YAAAC,CACF,IAAwC,CACtC,GAAM,CAACC,EAAYC,CAAa,EAAU,WAAqC,IAAI,EAEnF,OAAM,YAAU,IAAM,EACS,SAAY,CACvC,GAAI,CACF,IAAMC,EAAwB,MAAMP,EAAiBG,EAAaC,CAAW,EAE7EE,EAAcC,CAAqB,CACrC,OAASC,EAAO,CACd,QAAQ,MAAMA,CAAK,CACrB,CACF,GAEqB,CACvB,EAAG,CAACJ,EAAaD,CAAW,CAAC,EAEtBE,CACT,ECrCA,OAAS,iBAAAI,EAAe,cAAAC,MAAkB,QAUnC,IAAMC,EAAsBF,EAAwC,CACzE,eAAgB,IAAM,CAAC,EACvB,QAAS,GACT,QAAS,CAAE,GAAI,GAAI,SAAU,EAAG,CAClC,CAAC,EAEYG,EAAkB,IAAMF,EAAWC,CAAmB,EChBnE,OAAgB,UAAAE,EAAQ,YAAAC,EAAU,eAAAC,EAAa,aAAAC,MAAiC,QA+E5E,cAAAC,MAAA,oBA1EG,IAAMC,EAA0D,CAAC,CAAE,SAAAC,CAAS,IAAM,CACvF,GAAM,CAAE,WAAAC,CAAW,EAAIC,EAAc,EAE/BC,EAAgBC,EAAsC,CAC1D,GAAI,IAAI,IACR,SAAU,IAAI,GAChB,CAAC,EAEK,CAACC,EAASC,CAAU,EAAIC,EAAmC,CAC/D,GAAI,GACJ,SAAU,EACZ,CAAC,EAEK,CAACC,EAASC,CAAU,EAAIF,EAAS,EAAK,EACtC,CAACG,EAASC,CAAU,EAAIJ,EAAS,CAAC,EAElCK,EAAiBC,EAAY,CAACC,EAAoBC,IAAmB,CACzE,GAAI,CAACA,GAAQ,KAAK,EAAG,OAErB,IAAMC,EAAYD,EACf,MAAM,KAAK,EACX,IAAKE,GAAMA,EAAE,KAAK,CAAC,EACnB,OAAO,OAAO,EAEXC,EAAcf,EAAc,QAAQW,CAAQ,EAC9CK,EAAU,GAEdH,EAAU,QAASI,GAAU,CACtBF,EAAY,IAAIE,CAAK,IACxBF,EAAY,IAAIE,CAAK,EACrBD,EAAU,GAEd,CAAC,EAEGA,IACFV,EAAW,EAAK,EAChBE,EAAYU,GAAMA,EAAI,CAAC,EAE3B,EAAG,CAAC,CAAC,EAEL,OAAAC,EAAU,IAAM,CACd,GAAI,CAACrB,EAAY,QAEiB,SAAY,CAC5C,IAAMsB,EAAwC,CAAE,GAAGlB,CAAQ,EACvDmB,EAAY,GACZC,EAAU,GAEd,QAAWX,IAAY,CAAC,KAAM,QAAQ,EAAY,CAChD,IAAMC,EAAS,MAAM,KAAKZ,EAAc,QAAQW,CAAQ,CAAC,EAAE,KAAK,EAC1DY,EAAcX,EAAO,KAAK,GAAG,EAE/BA,EAAO,OAAS,IAClBS,EAAY,GAERE,IAAgBrB,EAAQS,CAAQ,IAClC,MAAMb,EAAW,aAAayB,EAAaZ,CAAQ,EACnDS,EAAYT,CAAQ,EAAIY,EACxBD,EAAU,IAGhB,CAEIA,GAAW,KAAK,UAAUF,CAAW,IAAM,KAAK,UAAUlB,CAAO,GACnEC,EAAWiB,CAAW,EAGxBd,EAAWe,CAAS,CACtB,GAE0B,CAC5B,EAAG,CAACvB,EAAYS,CAAO,CAAC,EAGtBZ,EAAC6B,EAAoB,SAApB,CAA6B,MAAO,CAAE,eAAAf,EAAgB,QAAAJ,EAAS,QAAAH,CAAQ,EACrE,SAAAL,EACH,CAEJ","names":["React","CoreClientContext","useCoreClient","context","createCoreClient","React","useCoreClientInitialization","authDetails","i18nOptions","coreClient","setCoreClient","initializedCoreClient","error","createContext","useContext","ScopeManagerContext","useScopeManager","useRef","useState","useCallback","useEffect","jsx","ScopeManagerProvider","children","coreClient","useCoreClient","scopeRegistry","useRef","ensured","setEnsured","useState","isReady","setIsReady","version","setVersion","registerScopes","useCallback","audience","scopes","newScopes","s","audienceSet","changed","scope","v","useEffect","nextEnsured","hasScopes","updated","scopeString","ScopeManagerContext"]}